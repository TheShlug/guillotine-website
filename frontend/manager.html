<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Manager profile and career statistics for The Guillotine Fantasy Football League.">
  <meta name="theme-color" content="#dc2626">
  <title>Manager Profile - The Guillotine</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>&#x1FA93;</text></svg>">
  <style>
    .profile-page {
      max-width: 1100px;
      margin: 0 auto;
    }

    .profile-header {
      text-align: center;
      padding: var(--spacing-xl) var(--spacing-lg);
      margin-bottom: var(--spacing-xl);
      background: linear-gradient(180deg, var(--color-bg-secondary) 0%, transparent 100%);
      border-bottom: 1px solid var(--color-border);
    }

    .profile-name {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: var(--spacing-sm);
    }

    .profile-badges {
      display: flex;
      justify-content: center;
      gap: var(--spacing-sm);
      flex-wrap: wrap;
      margin-top: var(--spacing-md);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-xs);
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .badge.champion {
      background: linear-gradient(135deg, var(--color-gold), #d97706);
      color: #1a1a24;
    }

    .badge.veteran {
      background: var(--color-bg-elevated);
      border: 1px solid var(--color-border);
      color: var(--color-text-secondary);
    }

    .badge.top-performer {
      background: linear-gradient(135deg, #16a34a, #22c55e);
      color: white;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-xl);
    }

    .stat-card {
      background: var(--color-bg-card);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg);
      text-align: center;
      transition: all var(--transition-fast);
    }

    .stat-card:hover {
      border-color: var(--color-border-light);
      transform: translateY(-2px);
    }

    .stat-card .value {
      font-size: 2rem;
      font-weight: 800;
      color: var(--color-gold);
    }

    .stat-card .value.green { color: #4ade80; }
    .stat-card .value.red { color: var(--color-accent-light); }

    .stat-card .label {
      font-size: 0.8rem;
      color: var(--color-text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-top: var(--spacing-xs);
    }

    .stat-card .sublabel {
      font-size: 0.75rem;
      color: var(--color-text-muted);
      margin-top: 2px;
    }

    .section {
      background: var(--color-bg-card);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-lg);
    }

    .section-title {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: var(--spacing-lg);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .season-history {
      display: grid;
      gap: var(--spacing-md);
    }

    .season-card {
      background: var(--color-bg-elevated);
      border-radius: var(--radius-md);
      padding: var(--spacing-md) var(--spacing-lg);
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: var(--spacing-lg);
    }

    .season-year {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--color-text-muted);
    }

    .season-details {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-md);
    }

    .season-detail {
      display: flex;
      flex-direction: column;
    }

    .season-detail .label {
      font-size: 0.7rem;
      color: var(--color-text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .season-detail .value {
      font-weight: 600;
      color: var(--color-text);
    }

    .season-finish {
      font-size: 1.5rem;
      font-weight: 800;
      min-width: 60px;
      text-align: center;
    }

    .season-finish.gold { color: var(--color-gold); }
    .season-finish.silver { color: #c0c0c0; }
    .season-finish.bronze { color: #cd7f32; }

    .highlights-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--spacing-md);
    }

    .highlight-card {
      background: var(--color-bg-elevated);
      border-radius: var(--radius-md);
      padding: var(--spacing-md);
    }

    .highlight-card .title {
      font-size: 0.8rem;
      color: var(--color-text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: var(--spacing-sm);
    }

    .highlight-card .main-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--color-text);
    }

    .highlight-card .context {
      font-size: 0.85rem;
      color: var(--color-text-secondary);
      margin-top: var(--spacing-xs);
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-sm);
      color: var(--color-text-secondary);
      text-decoration: none;
      font-weight: 500;
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--radius-sm);
      transition: all var(--transition-fast);
      margin-bottom: var(--spacing-lg);
    }

    .back-link:hover {
      color: var(--color-accent-light);
      background: var(--color-bg-card);
    }

    .loading-state, .error-state {
      text-align: center;
      padding: var(--spacing-2xl);
      color: var(--color-text-secondary);
    }

    .error-state {
      color: var(--color-accent-light);
    }

    @media (max-width: 768px) {
      .profile-name {
        font-size: 1.75rem;
      }

      .season-card {
        grid-template-columns: 1fr;
        text-align: center;
      }

      .season-details {
        justify-content: center;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="app-container profile-page">
    <a href="/" class="back-link">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      Back to Standings
    </a>

    <div id="profile-container">
      <div class="loading-state">
        <div class="axe-spinner" style="font-size: 2rem; margin-bottom: 1rem;">&#x1FA93;</div>
        <p>Loading manager profile...</p>
      </div>
    </div>

    <footer class="footer">
      <div class="footer-links">
        <a href="/" class="footer-link">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
            <polyline points="9 22 9 12 15 12 15 22"/>
          </svg>
          Home
        </a>
        <a href="/average-finishes" class="footer-link">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 20V10"/>
            <path d="M18 20V4"/>
            <path d="M6 20v-4"/>
          </svg>
          Historical Stats
        </a>
        <a href="/rules" class="footer-link">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
          </svg>
          League Rules
        </a>
        <a href="/season-recap" class="footer-link">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12 6 12 12 16 14"/>
          </svg>
          Season Recap
        </a>
        <a href="/death-bell" class="footer-link">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="8" r="5"/>
            <path d="M3 21h18M7 13v8M17 13v8M12 13v8"/>
          </svg>
          Death Bell
        </a>
      </div>
      <p class="footer-note">
        Data powered by <a href="https://sleeper.app" target="_blank" rel="noopener">Sleeper</a>
      </p>
    </footer>
  </div>

  <script type="module">
    async function loadProfile() {
      const container = document.getElementById('profile-container');

      // Get manager name from URL
      const pathParts = window.location.pathname.split('/');
      const managerName = decodeURIComponent(pathParts[pathParts.length - 1]);

      if (!managerName) {
        container.innerHTML = '<div class="error-state"><p>Manager not specified</p></div>';
        return;
      }

      try {
        const response = await fetch(`/api/manager/${encodeURIComponent(managerName)}`);
        if (!response.ok) throw new Error('Manager not found');

        const profile = await response.json();

        if (profile.career_stats.seasons_played === 0) {
          container.innerHTML = '<div class="error-state"><p>Manager not found in league history</p></div>';
          return;
        }

        renderProfile(profile, container);
        document.title = `${profile.user_name} - The Guillotine`;

      } catch (error) {
        console.error('Error:', error);
        container.innerHTML = '<div class="error-state"><p>Failed to load manager profile</p></div>';
      }
    }

    function renderProfile(profile, container) {
      const stats = profile.career_stats;

      // Generate badges
      let badges = '';
      if (stats.championships > 0) {
        badges += `<span class="badge champion">&#x1F3C6; ${stats.championships}x Champion</span>`;
      }
      if (stats.seasons_played >= 3) {
        badges += `<span class="badge veteran">&#x1F396; Veteran (${stats.seasons_played} seasons)</span>`;
      }
      if (stats.average_finish && stats.average_finish <= 6) {
        badges += `<span class="badge top-performer">&#x2B50; Elite Performer</span>`;
      }

      // Generate season history
      let seasonHistory = '';
      const sortedSeasons = Object.keys(profile.seasons).sort((a, b) => b - a);

      sortedSeasons.forEach(seasonYear => {
        const season = profile.seasons[seasonYear];
        const finishClass = season.finish_position === 1 ? 'gold' :
                           season.finish_position === 2 ? 'silver' :
                           season.finish_position === 3 ? 'bronze' : '';

        const finishText = season.finish_position ?
          (season.finish_position === 1 ? '1st' :
           season.finish_position === 2 ? '2nd' :
           season.finish_position === 3 ? '3rd' :
           `${season.finish_position}th`) : '-';

        seasonHistory += `
          <div class="season-card">
            <div class="season-year">${seasonYear}</div>
            <div class="season-details">
              ${season.draft_position ? `
                <div class="season-detail">
                  <span class="label">Draft Pos</span>
                  <span class="value">#${season.draft_position}</span>
                </div>
              ` : ''}
              <div class="season-detail">
                <span class="label">Total Pts</span>
                <span class="value">${season.season_total.toLocaleString()}</span>
              </div>
              <div class="season-detail">
                <span class="label">Avg/Week</span>
                <span class="value">${season.avg_score.toFixed(1)}</span>
              </div>
              ${season.chop_week ? `
                <div class="season-detail">
                  <span class="label">Eliminated</span>
                  <span class="value">Week ${season.chop_week}</span>
                </div>
              ` : ''}
              ${season.close_calls ? `
                <div class="season-detail">
                  <span class="label">Close Calls</span>
                  <span class="value">${season.close_calls}</span>
                </div>
              ` : ''}
            </div>
            <div class="season-finish ${finishClass}">${finishText}</div>
          </div>
        `;
      });

      container.innerHTML = `
        <div class="profile-header">
          <h1 class="profile-name">${profile.user_name}</h1>
          ${badges ? `<div class="profile-badges">${badges}</div>` : ''}
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="value">${stats.seasons_played}</div>
            <div class="label">Seasons Played</div>
          </div>
          <div class="stat-card">
            <div class="value ${stats.average_finish <= 6 ? 'green' : stats.average_finish >= 12 ? 'red' : ''}">${stats.average_finish ? stats.average_finish.toFixed(1) : '-'}</div>
            <div class="label">Avg Finish</div>
          </div>
          <div class="stat-card">
            <div class="value">${stats.championships}</div>
            <div class="label">Championships</div>
          </div>
          <div class="stat-card">
            <div class="value">${stats.top_3_finishes}</div>
            <div class="label">Top 3 Finishes</div>
          </div>
          <div class="stat-card">
            <div class="value">${stats.total_weeks_played}</div>
            <div class="label">Weeks Played</div>
          </div>
          <div class="stat-card">
            <div class="value">${stats.career_avg_score ? stats.career_avg_score.toFixed(1) : '-'}</div>
            <div class="label">Career Avg/Week</div>
          </div>
        </div>

        <div class="section">
          <h2 class="section-title">&#x1F3C5; Career Highlights</h2>
          <div class="highlights-grid">
            <div class="highlight-card">
              <div class="title">Best Week</div>
              <div class="main-value">${stats.best_week.score.toFixed(2)}</div>
              <div class="context">Season ${stats.best_week.season}, Week ${stats.best_week.week}</div>
            </div>
            <div class="highlight-card">
              <div class="title">Worst Week</div>
              <div class="main-value">${stats.worst_week.score > 0 ? stats.worst_week.score.toFixed(2) : '-'}</div>
              <div class="context">${stats.worst_week.season ? `Season ${stats.worst_week.season}, Week ${stats.worst_week.week}` : '-'}</div>
            </div>
            <div class="highlight-card">
              <div class="title">Total Career Points</div>
              <div class="main-value">${stats.total_points.toLocaleString()}</div>
              <div class="context">Across ${stats.total_weeks_played} weeks</div>
            </div>
            <div class="highlight-card">
              <div class="title">Close Calls</div>
              <div class="main-value">${stats.close_calls}</div>
              <div class="context">Times nearly eliminated (2nd to last or within 5 pts)</div>
            </div>
          </div>
        </div>

        ${stats.total_faab_spent > 0 ? `
        <div class="section">
          <h2 class="section-title">&#x1F4B0; FAAB Stats <span style="font-size: 0.7rem; font-weight: 400; color: var(--color-text-muted);">(since 2025)</span></h2>
          <div class="highlights-grid">
            <div class="highlight-card">
              <div class="title">Total FAAB Spent</div>
              <div class="main-value">$${stats.total_faab_spent.toLocaleString()}</div>
            </div>
            <div class="highlight-card">
              <div class="title">Total FAAB Wasted</div>
              <div class="main-value">$${stats.total_faab_wasted.toLocaleString()}</div>
            </div>
          </div>
        </div>
        ` : ''}

        <div class="section">
          <h2 class="section-title">&#x1F4C5; Season History</h2>
          <div class="season-history">
            ${seasonHistory}
          </div>
        </div>
      `;
    }

    loadProfile();
  </script>
</body>
</html>
